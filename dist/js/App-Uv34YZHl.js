import{d as e,j as t}from"./index-DvkTr9A0.js";import{r as s}from"./react-vendor-DusJrpQ4.js";import{d as a}from"./dayjs.min-B7aZrnUZ.js";import{B as r,I as l,S as i}from"./XiuxianUserSelector-BeSIaO55.js";import{X as n}from"./XiuxianStatCard-C00-4ySV.js";import{X as o}from"./XiuxianPageWrapper-J-VCIeJX.js";import{X as c}from"./XiuxianPageTitle-JKpbZp5N.js";import{X as d}from"./XiuxianTableContainer-D3-OI_va.js";import{X as x}from"./XiuxianRefreshButton-Dx0qkUx0.js";import{X as m}from"./XiuxianEmptyState-Bd8vRCqg.js";import{X as p}from"./XiuxianTableWithPagination-B8H7HzDb.js";import{F as u}from"./index-DZmfV3M5.js";import{R as h}from"./PlusOutlined-DOI7ntUO.js";import{R as j,P as g}from"./StopOutlined-BM8AKjhh.js";import{I as f,S as v,T as y}from"./AntdIcon-B60ESYgq.js";import{R as b,a as N}from"./ExclamationCircleOutlined-DtClB_l7.js";import{R as w}from"./CheckCircleOutlined-DGDCfLxG.js";import{R as S}from"./DeleteOutlined-Ce-3AUGO.js";import{R as I}from"./EyeOutlined-CrhxmRzK.js";import{M as k}from"./index-Cch_gHA7.js";import{R as C,C as T}from"./row-RmOJyWCY.js";import{s as O}from"./index-BN6UCH9C.js";import{T as z}from"./index-DkvAnLSe.js";import{R as X}from"./UserOutlined-BYp16Q3Z.js";import"./index-Bkge7qsY.js";import"./context-Br-Fql-b.js";import"./index-CpxjGGZm.js";var P={};Object.defineProperty(P,"__esModule",{value:!0});var E=P.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"};function R(){return R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},R.apply(this,arguments)}const D=(e,t)=>s.createElement(f,R({},e,{ref:t,icon:E})),L=s.forwardRef(D);var M={};Object.defineProperty(M,"__esModule",{value:!0});var $=M.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"};function A(){return A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},A.apply(this,arguments)}const B=(e,t)=>s.createElement(f,A({},e,{ref:t,icon:$})),Y=s.forwardRef(B),{TextArea:_}=l,{Option:q}=i,F=()=>{const[f,P]=s.useState(null),[E,R]=s.useState(null),[D,M]=s.useState(!1),[$,A]=s.useState(!1),[B]=u.useForm(),[F,H]=s.useState(""),[G,J]=s.useState({current:1,pageSize:10,total:0}),U=async()=>{try{const s=await(t={global:!0},e({url:"/message-stats",method:"GET",params:t}));R(s.data)}catch(s){O.error("获取统计信息失败")}var t},V=async(t,s=1,a=10)=>{if(t){M(!0);try{const l=await(r={userId:t,page:s,pageSize:a},e({url:"/messages",method:"GET",params:r}));P(l.data),J({current:l.data.page,pageSize:l.data.pageSize,total:l.data.total})}catch(l){O.error("获取消息列表失败")}finally{M(!1)}var r}},W=async(t,s)=>{try{await(a={userId:t,messageId:s},e({url:"/messages",method:"DELETE",data:a})),O.success("删除成功"),V(t,G.current,G.pageSize)}catch(r){O.error("删除失败")}var a},K=[{title:t.jsxs("div",{className:"flex items-center gap-2 text-purple-400 font-bold",children:[t.jsx(L,{className:"text-lg"}),t.jsx("span",{children:"消息标题"})]}),dataIndex:"title",key:"title",width:200,ellipsis:!0,render:e=>t.jsx("span",{className:"text-white font-medium",children:e})},{title:t.jsx("div",{className:"flex items-center gap-2 text-blue-400 font-bold",children:t.jsx("span",{children:"消息内容"})}),dataIndex:"content",key:"content",width:300,ellipsis:!0,render:e=>t.jsx(y,{title:e,children:t.jsx("span",{className:"text-slate-300",children:e.length>50?`${e.substring(0,50)}...`:e})})},{title:t.jsx("div",{className:"flex items-center gap-2 text-orange-400 font-bold",children:t.jsx("span",{children:"消息类型"})}),dataIndex:"type",key:"type",width:120,render:e=>{const s={system:{color:"blue",text:"系统消息"},announcement:{color:"red",text:"公告"},reward:{color:"green",text:"奖励通知"},activity:{color:"orange",text:"活动通知"},personal:{color:"purple",text:"个人消息"}}[e]||{color:"default",text:e};return t.jsx(z,{color:s.color,children:s.text})}},{title:t.jsxs("div",{className:"flex items-center gap-2 text-yellow-400 font-bold",children:[t.jsx(b,{className:"text-lg"}),t.jsx("span",{children:"优先级"})]}),dataIndex:"priority",key:"priority",width:100,render:e=>{const s={1:{color:"default",text:"低"},2:{color:"blue",text:"普通"},3:{color:"orange",text:"高"},4:{color:"red",text:"紧急"}}[e]||{color:"default",text:"普通"};return t.jsx(z,{color:s.color,children:s.text})}},{title:t.jsxs("div",{className:"flex items-center gap-2 text-green-400 font-bold",children:[t.jsx(w,{className:"text-lg"}),t.jsx("span",{children:"状态"})]}),dataIndex:"status",key:"status",width:100,render:e=>{const s={0:{color:"red",text:"未读"},1:{color:"green",text:"已读"},2:{color:"default",text:"已删除"}}[e]||{color:"default",text:"未知"};return t.jsx(z,{color:s.color,children:s.text})}},{title:t.jsxs("div",{className:"flex items-center gap-2 text-cyan-400 font-bold",children:[t.jsx(X,{className:"text-lg"}),t.jsx("span",{children:"发送者"})]}),dataIndex:"senderName",key:"senderName",width:120,render:e=>t.jsx("span",{className:"text-slate-300",children:e||"系统"})},{title:t.jsxs("div",{className:"flex items-center gap-2 text-pink-400 font-bold",children:[t.jsx(N,{className:"text-lg"}),t.jsx("span",{children:"创建时间"})]}),dataIndex:"createTime",key:"createTime",width:180,render:e=>t.jsx("span",{className:"text-slate-400 text-sm",children:a(e).format("YYYY-MM-DD HH:mm:ss")})},{title:t.jsx("div",{className:"flex items-center gap-2 text-red-400 font-bold",children:t.jsx("span",{children:"操作"})}),key:"action",width:120,render:(e,s)=>t.jsx(v,{children:t.jsx(g,{title:"确定要删除这条消息吗？",onConfirm:()=>W(F,s.id),okText:"确定",cancelText:"取消",children:t.jsx(r,{type:"text",size:"small",icon:t.jsx(S,{}),className:"text-red-400 hover:text-red-300 hover:bg-red-400/10",children:"删除"})})})}];return s.useEffect(()=>{U()},[]),t.jsxs(o,{children:[t.jsx(c,{icon:t.jsx(L,{}),title:"站内信管理",subtitle:"管理修仙界道友的站内信系统",actions:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(r,{type:"primary",icon:t.jsx(h,{}),onClick:()=>A(!0),className:"bg-gradient-to-r from-purple-500 to-pink-500 border-0 hover:from-purple-600 hover:to-pink-600",children:"发送消息"}),t.jsx(r,{danger:!0,icon:t.jsx(j,{}),onClick:async()=>{try{const t=await e({url:"/message-stats",method:"POST"});O.success(`清理成功，共清理 ${t.data.cleanedCount} 条过期消息`),U()}catch(t){O.error("清理失败")}},className:"hover:bg-red-600",children:"清理过期"}),t.jsx(x,{loading:D,onClick:()=>{U(),F&&V(F,G.current,G.pageSize)}})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[t.jsx(n,{title:"总消息数",value:((null==E?void 0:E.total)||0).toLocaleString(),icon:t.jsx(L,{}),gradient:"blue"}),t.jsx(n,{title:"未读消息",value:((null==E?void 0:E.unread)||0).toLocaleString(),icon:t.jsx(b,{}),gradient:"red"}),t.jsx(n,{title:"已读消息",value:((null==E?void 0:E.read)||0).toLocaleString(),icon:t.jsx(w,{}),gradient:"green"}),t.jsx(n,{title:"已删除消息",value:((null==E?void 0:E.deleted)||0).toLocaleString(),icon:t.jsx(S,{}),gradient:"purple"})]}),t.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-2xl p-6 shadow-lg",children:[t.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[t.jsx(I,{className:"text-blue-400"}),"查看用户消息"]}),t.jsxs("div",{className:"flex gap-4 items-center",children:[t.jsx(l,{placeholder:"输入用户ID查看消息...",value:F,onChange:e=>H(e.target.value),className:"xiuxian-input flex-1",onPressEnter:()=>V(F)}),t.jsx(r,{type:"primary",icon:t.jsx(I,{}),onClick:()=>V(F),disabled:!F,className:"bg-gradient-to-r from-blue-500 to-cyan-500 border-0 hover:from-blue-600 hover:to-cyan-600",children:"查看消息"})]})]}),t.jsx(d,{title:"消息列表",icon:t.jsx(L,{}),children:F?0===(null==f?void 0:f.messages.length)?t.jsx(m,{icon:"📭",title:"暂无消息",description:"该用户目前没有任何消息记录"}):t.jsx(p,{columns:K,dataSource:(null==f?void 0:f.messages)||[],rowKey:"id",loading:D,pagination:{current:G.current,pageSize:G.pageSize,total:G.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`},onPaginationChange:(e,t)=>{V(F,e,t||10)},rowClassName:()=>"hover:bg-gradient-to-r hover:from-purple-500/10 hover:to-blue-500/10 transition-all duration-300 bg-slate-700 hover:bg-slate-600"}):t.jsx(m,{icon:"📝",title:"请先输入用户ID",description:"在上方输入框中输入用户ID来查看该用户的消息列表"})})]}),t.jsx(k,{title:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Y,{className:"text-purple-400"}),t.jsx("span",{className:"text-white",children:"发送站内信"})]}),open:$,onCancel:()=>A(!1),footer:null,className:"xiuxian-modal",width:600,children:t.jsxs(u,{form:B,layout:"vertical",onFinish:async t=>{try{const s={title:t.title,content:t.content,type:t.type,priority:t.priority||2,receivers:t.receivers?t.receivers.split(",").map(e=>e.trim()):[],expireTime:t.expireTime?new Date(t.expireTime).getTime():void 0};await(t=>e({url:"/messages",method:"POST",data:t}))(s),O.success("消息发送成功"),A(!1),B.resetFields(),U()}catch(s){O.error("发送消息失败")}},initialValues:{type:"system",priority:2},className:"mt-4",children:[t.jsx(u.Item,{name:"title",label:t.jsx("span",{className:"text-slate-300",children:"消息标题"}),rules:[{required:!0,message:"请输入消息标题"}],children:t.jsx(l,{placeholder:"请输入消息标题",className:"xiuxian-input"})}),t.jsx(u.Item,{name:"content",label:t.jsx("span",{className:"text-slate-300",children:"消息内容"}),rules:[{required:!0,message:"请输入消息内容"}],children:t.jsx(_,{rows:4,placeholder:"请输入消息内容",className:"xiuxian-input"})}),t.jsxs(C,{gutter:16,children:[t.jsx(T,{span:12,children:t.jsx(u.Item,{name:"type",label:t.jsx("span",{className:"text-slate-300",children:"消息类型"}),rules:[{required:!0,message:"请选择消息类型"}],children:t.jsxs(i,{placeholder:"请选择消息类型",className:"xiuxian-select",children:[t.jsx(q,{value:"system",children:"系统消息"}),t.jsx(q,{value:"announcement",children:"公告"}),t.jsx(q,{value:"reward",children:"奖励通知"}),t.jsx(q,{value:"activity",children:"活动通知"}),t.jsx(q,{value:"personal",children:"个人消息"})]})})}),t.jsx(T,{span:12,children:t.jsx(u.Item,{name:"priority",label:t.jsx("span",{className:"text-slate-300",children:"优先级"}),rules:[{required:!0,message:"请选择优先级"}],children:t.jsxs(i,{placeholder:"请选择优先级",className:"xiuxian-select",children:[t.jsx(q,{value:1,children:"低"}),t.jsx(q,{value:2,children:"普通"}),t.jsx(q,{value:3,children:"高"}),t.jsx(q,{value:4,children:"紧急"})]})})})]}),t.jsx(u.Item,{name:"receivers",label:t.jsx("span",{className:"text-slate-300",children:"接收者ID"}),extra:t.jsx("span",{className:"text-slate-500",children:"多个用户ID用逗号分隔，留空表示全服发送"}),children:t.jsx(l,{placeholder:"例如: 123456,789012",className:"xiuxian-input"})}),t.jsx(u.Item,{name:"expireTime",label:t.jsx("span",{className:"text-slate-300",children:"过期时间"}),extra:t.jsx("span",{className:"text-slate-500",children:"可选，留空表示永不过期"}),children:t.jsx(l,{type:"datetime-local",className:"xiuxian-input"})}),t.jsx(u.Item,{children:t.jsxs(v,{children:[t.jsx(r,{type:"primary",htmlType:"submit",icon:t.jsx(Y,{}),className:"bg-gradient-to-r from-purple-500 to-pink-500 border-0 hover:from-purple-600 hover:to-pink-600",children:"发送"}),t.jsx(r,{onClick:()=>A(!1),className:"bg-slate-700 hover:bg-slate-600 border-slate-600",children:"取消"})]})})]})})]})};export{F as default};
