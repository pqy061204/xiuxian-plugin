import{a as e,j as t}from"./index-DBfjTvIX.js";import{c as a}from"./config-CeDv2UoE.js";import{r as s}from"./react-vendor-DC8kK7ng.js";import{s as n}from"./index-CPM7frdn.js";import{c as r}from"./index-DXDPliM2.js";import"./XiuxianUserSelector-CxhKHIHB.js";import{X as l,a as o}from"./XiuxianPageTitle-DlJXdf7F.js";import{X as i}from"./XiuxianTabGroup-uAm7pj8V.js";import{M as c}from"./index-DV6NQIc_.js";import"./reactNode-DFpyyHOf.js";import"./context-BZ-Wt8ZT.js";import"./extendsObject-DbwGHlKD.js";import"./index-DVZYsZ2A.js";const d=({name:e,description:a,type:s,value:n,onChange:l,className:o=""})=>t.jsxs("div",{className:`bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-xl p-4 shadow-lg ${o}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"text-white font-medium text-sm",children:e}),t.jsx("span",{className:r("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border",{string:"bg-blue-500/20 text-blue-400 border-blue-500/30",number:"bg-green-500/20 text-green-400 border-green-500/30",boolean:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",array:"bg-purple-500/20 text-purple-400 border-purple-500/30"}[s]),children:s.toUpperCase()})]}),t.jsx("p",{className:"text-slate-400 text-xs mb-3",children:a}),(()=>{switch(s){case"boolean":return t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:!!n,onChange:e=>l(e.target.checked),className:"w-4 h-4 text-purple-600 bg-slate-700 border-slate-600 rounded focus:ring-purple-500 focus:ring-2"}),t.jsx("span",{className:"ml-2 text-slate-300 text-sm",children:n?"启用":"禁用"})]});case"array":return t.jsx("textarea",{value:JSON.stringify(n||[],null,2),onChange:e=>{try{const t=JSON.parse(e.target.value);l(t)}catch(t){}},className:"w-full p-2 xiuxian-input text-xs font-mono rounded-lg",rows:3,placeholder:"请输入JSON数组格式"});default:return t.jsx("input",{type:"number"===s?"number":"text",value:String(n||""),onChange:e=>{const t="number"===s?parseFloat(e.target.value)||0:e.target.value;l(t)},className:"w-full p-2 xiuxian-input rounded-lg",placeholder:`请输入${e}`})}})()]}),u=()=>{const[t,a]=s.useState(null),[r,l]=s.useState(!1),[o,i]=s.useState("CD配置"),[c,d]=s.useState(""),[u,x]=s.useState(!1),m=async()=>{l(!0);try{const t=await(async t=>{try{return await e({url:"/config",params:{app:t}})}catch(a){return null}})("xiuxian");if(t){const e=t.data||t;a(e),d(JSON.stringify(e,null,2))}}catch(t){n.error("加载配置失败")}finally{l(!1)}};return s.useEffect(()=>{m()},[]),{config:t,loading:r,activeTab:o,setActiveTab:i,jsonConfig:c,setJsonConfig:d,message:n,loadConfig:m,handleSave:async t=>{l(!0);try{await(async(t,a)=>{try{return await e({url:"/config",method:"POST",data:{name:t,data:a}})}catch(s){return null}})("xiuxian",t),n.success("配置保存成功"),m()}catch(a){}finally{l(!1)}},handleConfigChange:(e,s)=>{if(!t)return;const n=e.split("."),r={...t};let l=r;for(let t=0;t<n.length-1;t++)l[n[t]]||(l[n[t]]={}),l=l[n[t]];l[n[n.length-1]]=s,a(r),d(JSON.stringify(r,null,2))},getConfigValue:e=>{if(!t)return;const a=e.split(".");let s=t;for(const t of a)s=null==s?void 0:s[t];return s},open:u,setOpen:x}};function x(){const{config:e,loading:s,activeTab:n,setActiveTab:r,jsonConfig:x,setJsonConfig:m,message:p,loadConfig:h,handleSave:g,handleConfigChange:f,getConfigValue:b,open:j,setOpen:y}=u(),N=a.map(e=>({name:e.name,icon:e.icon,content:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-white text-xl font-semibold flex items-center",children:[t.jsx("span",{className:"mr-2",children:e.icon}),e.name]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.items.map(e=>t.jsx(d,{name:e.name,description:e.description,type:"json"===e.type?"array":e.type,value:b(e.key),onChange:t=>f(e.key,t)},e.key))})]})}));return t.jsxs(l,{children:[t.jsx(o,{icon:"⚙️",title:"配置管理",subtitle:"管理系统配置参数",actions:t.jsxs("div",{className:"flex space-x-3",children:[t.jsxs("button",{onClick:h,disabled:s,className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg hover:from-blue-600 hover:to-cyan-600 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50",children:[t.jsx("span",{className:"mr-2",children:"🔄"}),s?"刷新中...":"刷新配置"]}),t.jsxs("button",{onClick:()=>y(!0),className:"px-2 py-1 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-md hover:from-blue-600 hover:to-cyan-600 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50",children:[t.jsx("span",{className:"mr-2",children:"🔄"}),"JSON编辑"]}),"JSON编辑"!==n&&t.jsxs("button",{onClick:()=>e&&g(e),disabled:s||!e,className:"px-2 py-1 rounded-md bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx("span",{className:"mr-2",children:"💾"}),s?"保存中...":"保存配置"]})]})}),t.jsx(i,{tabs:N,activeTab:n,onTabChange:r}),t.jsx(c,{className:"xiuxian-modal",title:"JSON配置",open:j,onCancel:()=>y(!1),onOk:()=>{try{const e=JSON.parse(x);g(e),y(!1)}catch(e){p.error("JSON格式错误")}},cancelText:"取消",okText:"确定",children:t.jsx("div",{children:t.jsx("div",{className:"mb-4",children:t.jsx("textarea",{value:x,onChange:e=>m(e.target.value),className:"w-full h-96 p-4 xiuxian-input rounded-xl font-mono text-sm",placeholder:"请输入JSON格式的配置..."})})})})]})}export{x as default};
