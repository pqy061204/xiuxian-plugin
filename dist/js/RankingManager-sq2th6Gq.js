import{j as e,u as t}from"./index-1Buk7MHt.js";import{c as a}from"./index-Cy_K9d2s.js";import{l as s}from"./config-BU5eskQO.js";import{r}from"./react-vendor-a03lyGlx.js";import{g as l,a as n,t as i}from"./rankings-ElWVOIGE.js";import{R as o,X as d}from"./XiuxianStatCard-BmdM8AWM.js";import{R as c}from"./TeamOutlined-MQ2Fhlnq.js";import{R as x}from"./BankOutlined-B-6AiGBO.js";import{R as m}from"./StarOutlined-88KrNGZL.js";import{R as g}from"./FireOutlined-BupGTZFy.js";import{R as u}from"./TrophyOutlined-BGUN__ya.js";import{s as p}from"./index-CM58c4md.js";import"./XiuxianUserSelector-BMQSkCjs.js";import{X as j,a as h}from"./XiuxianPageTitle-ClGkPvjU.js";import{X as b}from"./XiuxianTableContainer-Ck0rxAnn.js";import{X as f}from"./XiuxianRefreshButton-j6mRwBxx.js";import{F as v}from"./Table-D7hXmRTc.js";import"./reactNode-CNKl2Mmk.js";import"./extendsObject-C6YrUve6.js";import"./index-BMwxKtRD.js";const k=[{value:"ASSOCIATION_POWER",label:"宗门综合实力",icon:e.jsx(o,{})},{value:"ASSOCIATION_MEMBERS",label:"宗门成员数",icon:e.jsx(c,{})},{value:"ASSOCIATION_LINGSHI",label:"宗门灵石池",icon:e.jsx(x,{})},{value:"ASSOCIATION_LEVEL",label:"宗门等级",icon:e.jsx(m,{})},{value:"PLAYER_LEVEL",label:"玩家境界",icon:e.jsx(g,{})},{value:"PLAYER_ATTACK",label:"玩家攻击力",icon:e.jsx(u,{})},{value:"PLAYER_DEFENSE",label:"玩家防御力",icon:e.jsx(u,{})}];function N(){const{rankingStats:x,selectedRankingType:g,rankingLimit:N,rankingData:y,loading:S,getRankingTypeLabel:R,handleTriggerCalculation:w,fetchRankingStats:C,handleRankingTypeChange:E,handleRankingLimitChange:L,fetchRankingData:T}=(()=>{const{user:e}=t(),[a,s]=r.useState(!1),[o,d]=r.useState(null),[c,x]=r.useState("ASSOCIATION_POWER"),[m,g]=r.useState([]),[u,j]=r.useState(10),h=async()=>{if(e)try{const e=localStorage.getItem("token");if(!e)return void p.error("未找到登录令牌");const t=await l(e);t.success&&t.data?d(t.data):p.error(t.message||"获取排名统计失败")}catch(t){p.error("获取排名统计失败")}},b=async(t,a)=>{if(e){s(!0);try{const e=localStorage.getItem("token");if(!e)return void p.error("未找到登录令牌");const s=await n(e,{type:t,limit:a});s.success&&s.data?g(s.data):p.error(s.message||"获取排名数据失败")}catch(r){p.error("获取排名数据失败")}finally{s(!1)}}};return r.useEffect(()=>{h(),b(c,u)},[e]),{rankingStats:o,selectedRankingType:c,rankingData:m,rankingLimit:u,loading:a,handleRankingTypeChange:e=>{x(e),b(e,u)},handleRankingLimitChange:e=>{j(e),b(c,e)},getRankingTypeLabel:e=>{const t=k.find(t=>t.value===e);return t?t.label:e},fetchRankingStats:h,fetchRankingData:b,handleTriggerCalculation:async()=>{if(e)try{const e=localStorage.getItem("token");if(!e)return void p.error("未找到登录令牌");p.loading("正在计算排名...",0);const t=await i(e);p.destroy(),t.success?(p.success("排名计算完成"),h(),b(c,u)):p.error(t.message||"排名计算失败")}catch(t){p.destroy(),p.error("触发排名计算失败")}}}})(),O=[{title:e.jsx("div",{className:"flex items-center gap-2 text-purple-400 font-bold",children:e.jsx("span",{children:"排名"})}),key:"rank",width:80,render:(t,s)=>e.jsx("div",{className:"flex items-center justify-center",children:s.rank<=3?e.jsx("div",{className:a("w-8 h-8 rounded-full flex items-center justify-center text-white font-bold",{"bg-yellow-500":1===s.rank,"bg-gray-400":2===s.rank,"bg-orange-500":3===s.rank}),children:s.rank}):e.jsx("span",{className:"text-slate-400 font-medium",children:s.rank})})},{title:e.jsx("div",{className:"flex items-center gap-2 text-blue-400 font-bold",children:e.jsx("span",{children:"名称"})}),key:"name",width:200,render:(t,a)=>{var s,r;return e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white",children:a.name}),(null==(s=a.extra)?void 0:s.名号)&&e.jsxs("div",{className:"text-xs text-slate-400",children:["道号: ",a.extra.名号]}),(null==(r=a.extra)?void 0:r.宗主)&&e.jsxs("div",{className:"text-xs text-slate-400",children:["宗主: ",a.extra.宗主]})]})}},{title:e.jsx("div",{className:"flex items-center gap-2 text-green-400 font-bold",children:e.jsx("span",{children:"PLAYER_LEVEL"===g?"境界":"数值"})}),key:"value",width:120,render:(t,a)=>"PLAYER_LEVEL"===g?e.jsx("div",{className:"text-sm font-medium text-blue-400",children:s[a.value]}):e.jsx("div",{className:"text-sm font-bold text-green-400",children:a.value.toLocaleString()})},{title:e.jsx("div",{className:"flex items-center gap-2 text-yellow-400 font-bold",children:e.jsx("span",{children:"类型"})}),key:"type",width:100,render:(t,a)=>{var s;return e.jsx("div",{className:"text-sm text-slate-400",children:"player"===(null==(s=a.extra)?void 0:s.type)?"玩家":"宗门"})}}];return e.jsxs(j,{children:[e.jsx(h,{icon:e.jsx(u,{}),title:"排行榜管理",subtitle:"管理修仙界各种排行榜数据",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"px-2 py-1 rounded-md bg-gradient-to-r from-green-500 to-emerald-500 text-white hover:from-green-600 hover:to-emerald-600 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2",onClick:w,children:[e.jsx(u,{}),"重新计算排名"]}),e.jsx(f,{loading:S,onClick:()=>{C(),T(g,N)}})]})}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(d,{title:"总排行榜数",value:x.associationCount+x.playerCount,icon:e.jsx(u,{}),gradient:"purple"}),e.jsx(d,{title:"玩家排行榜",value:x.playerCount,icon:e.jsx(o,{}),gradient:"blue"}),e.jsx(d,{title:"宗门排行榜",value:x.associationCount,icon:e.jsx(c,{}),gradient:"green"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-2xl p-6 shadow-lg mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"text-purple-400"}),"排名类型"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:k.map(t=>e.jsx("button",{className:a("p-3 rounded-xl border-2 transition-all duration-200",g===t.value?"border-purple-500 bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-400 shadow-lg":"border-slate-600 bg-slate-700/50 text-slate-300 hover:border-slate-500 hover:bg-slate-600/50"),onClick:()=>E(t.value),children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.icon,e.jsx("span",{className:"text-sm",children:t.label})]})},t.value))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-2xl p-6 shadow-lg mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(m,{className:"text-yellow-400"}),"显示数量"]}),e.jsx("div",{className:"flex gap-4",children:[10,20,50,100].map(t=>e.jsxs("button",{className:a("px-4 py-2 rounded-lg transition-all duration-200",N===t?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 border border-slate-600"),onClick:()=>L(t),children:["前",t,"名"]},t))})]}),e.jsx(b,{title:`${R(g)} - 前${N}名`,icon:e.jsx(u,{}),children:e.jsx(v,{columns:O,dataSource:y,rowKey:"id",loading:S,pagination:!1,scroll:{x:800},rowClassName:()=>" bg-slate-700 hover:bg-slate-600",className:"bg-transparent xiuxian-table"})})]})}export{N as default};
