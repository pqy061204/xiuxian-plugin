import{a as e,j as s,u as a}from"./index-B2kNOiSW.js";import"./index-DXDPliM2.js";import{I as t,B as l}from"./XiuxianUserSelector-BF0ikhJO.js";import{X as r}from"./XiuxianInfoCard-uwO8PzqJ.js";import{r as i}from"./react-vendor-DC8kK7ng.js";import{M as n}from"./index-Du8BvPLj.js";import{R as o}from"./CloseOutlined-o6jXGAp0.js";import{F as d}from"./index-CNY5tfv2.js";import{C as c}from"./index-BtLYJyHx.js";import{R as x,C as h}from"./row-Bx9DYSg2.js";import{T as m,R as u}from"./index-C6llOLMG.js";import{T as g}from"./index-CmqRciKh.js";import{R as j}from"./PlusOutlined-CfI3nvkf.js";import{R as p}from"./SaveOutlined-DOcOmnyI.js";import{s as b}from"./index-BYawNXHP.js";import{R as v}from"./DeleteOutlined-Bym2ICp0.js";import{p as f}from"./config-CeDv2UoE.js";import{X as N,a as y}from"./XiuxianPageTitle-DZEpOGbC.js";import{X as w}from"./XiuxianSearchBar-D3Kv-zDm.js";import{I as k,X as S,T as C}from"./XiuxianTableContainer-DhC13tFt.js";import{X as I}from"./XiuxianRefreshButton-xkCbosgb.js";import{X as T}from"./XiuxianTableWithPagination-DKSLFAl9.js";import{R as D}from"./EyeOutlined-CSmtF8Qz.js";import"./reactNode-DFpyyHOf.js";import"./context-DpP0BR6V.js";import"./extendsObject-CAj5MA3o.js";import"./index-DVZYsZ2A.js";import"./Table-DDK18TB_.js";import"./index-CV6p3N25.js";import"./PlusOutlined-ByZyTB3m.js";import"./SearchOutlined-DbEbI350.js";var V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 312H696v-16c0-101.6-82.4-184-184-184s-184 82.4-184 184v16H192c-17.7 0-32 14.3-32 32v536c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V344c0-17.7-14.3-32-32-32zm-432-16c0-61.9 50.1-112 112-112s112 50.1 112 112v16H400v-16zm392 544H232V384h96v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h224v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h96v456z"}}]},name:"shopping",theme:"outlined"};function z(){return z=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},z.apply(this,arguments)}const E=(e,s)=>i.createElement(k,z({},e,{ref:s,icon:V})),O=i.forwardRef(E),X=({najieDetailVisible:e,setNajieDetailVisible:a,selectedNajie:t,getTotalItems:l})=>{var i,d,c,x,h,m,u,g,j;return s.jsx(n,{title:s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-xl font-bold text-white",children:"corrupted"===(null==t?void 0:t.数据状态)?"损坏数据详情":"背包详情"})}),open:e,onCancel:()=>a(!1),footer:null,closeIcon:s.jsx(o,{className:"text-white"}),className:"xiuxian-modal",width:"corrupted"===(null==t?void 0:t.数据状态)?1200:800,children:t&&s.jsx("div",{className:"space-y-6",children:"corrupted"===t.数据状态?s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 text-red-400 flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),"损坏数据 - 原始JSON内容"]}),s.jsxs("div",{className:"bg-gradient-to-br from-red-500/10 to-pink-500/10 backdrop-blur-xl border border-red-500/30 rounded-xl p-4",children:[s.jsxs("p",{className:"text-sm text-red-300 mb-2",children:["错误信息: ",t.错误信息]}),s.jsx("pre",{className:"text-xs text-slate-300 overflow-auto max-h-96 bg-slate-800/50 p-3 rounded-lg border border-slate-700/50",children:t.原始数据})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 text-white flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),"基础信息"]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(r,{label:"用户ID",value:t.userId,gradient:"blue"}),s.jsx(r,{label:"背包等级",value:t.等级||1,gradient:"green"}),s.jsx(r,{label:"总物品数",value:l(t),gradient:"purple"}),s.jsx(r,{label:"当前灵石",value:`${(null==(i=t.灵石)?void 0:i.toLocaleString())||0}`,gradient:"green"})]})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 text-white flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),"物品统计"]}),s.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[s.jsx(r,{label:"装备",value:(null==(d=t.装备)?void 0:d.length)||0,gradient:"blue"}),s.jsx(r,{label:"丹药",value:(null==(c=t.丹药)?void 0:c.length)||0,gradient:"green"}),s.jsx(r,{label:"道具",value:(null==(x=t.道具)?void 0:x.length)||0,gradient:"purple"}),s.jsx(r,{label:"功法",value:(null==(h=t.功法)?void 0:h.length)||0,gradient:"orange"})]})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 text-white flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),"其他物品"]}),s.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[s.jsx(r,{label:"草药",value:(null==(m=t.草药)?void 0:m.length)||0,gradient:"green"}),s.jsx(r,{label:"材料",value:(null==(u=t.材料)?void 0:u.length)||0,gradient:"yellow"}),s.jsx(r,{label:"仙宠",value:(null==(g=t.仙宠)?void 0:g.length)||0,gradient:"pink"}),s.jsx(r,{label:"灵石上限",value:`${(null==(j=t.灵石上限)?void 0:j.toLocaleString())||0}`,gradient:"blue"})]})]})]})})})},B=[{key:"装备",label:"装备",color:"from-blue-500/10 to-cyan-500/10"},{key:"丹药",label:"丹药",color:"from-red-500/10 to-pink-500/10"},{key:"道具",label:"道具",color:"from-green-500/10 to-emerald-500/10"},{key:"功法",label:"功法",color:"from-purple-500/10 to-pink-500/10"},{key:"草药",label:"草药",color:"from-yellow-500/10 to-orange-500/10"},{key:"材料",label:"材料",color:"from-indigo-500/10 to-purple-500/10"},{key:"仙宠",label:"仙宠",color:"from-pink-500/10 to-rose-500/10"},{key:"仙宠口粮",label:"仙宠口粮",color:"from-amber-500/10 to-yellow-500/10"}];function R({visible:e,onCancel:a,onSave:r,najie:o,loading:u=!1}){const[f]=d.useForm(),[N,y]=i.useState(null),[w,k]=i.useState("");i.useEffect(()=>{e&&o&&(y({...o}),f.setFieldsValue({userId:o.userId,"灵石":o.灵石,"灵石上限":o.灵石上限,"等级":o.等级}))},[e,o,f]);const S=(e,s,a,t)=>{if(!N)return;const l=(N[e]||[]).map((e,l)=>l===s?{...e,[a]:t}:e);y({...N,[e]:l})},C=(e,a,r)=>s.jsx(c,{className:"bg-gradient-to-br from-slate-700/50 to-slate-800/50 border border-slate-600/50 mb-3",size:"small",children:s.jsxs(x,{gutter:[8,8],children:[s.jsxs(h,{span:8,children:[s.jsx(t,{placeholder:"物品名称",value:e.name,onChange:e=>S(a,r,"name",e.target.value),className:"xiuxian-input"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500/0 to-pink-500/0 group-hover:from-purple-500/10 group-hover:to-pink-500/10 transition-all duration-300"})]}),s.jsx(h,{span:4,children:s.jsx(t,{placeholder:"品质",value:e.grade,onChange:e=>S(a,r,"grade",e.target.value),className:"xiuxian-input"})}),s.jsx(h,{span:3,children:s.jsx(m,{placeholder:"品级",value:e.pinji,onChange:e=>S(a,r,"pinji",e),className:"w-full xiuxian-input",min:1})}),s.jsx(h,{span:3,children:s.jsx(m,{placeholder:"数量",value:e.数量,onChange:e=>S(a,r,"数量",e),className:"w-full bg-slate-600/50 border-slate-500 text-white hover:bg-white hover:text-gray-900 focus:bg-white focus:text-gray-900",min:1})}),s.jsx(h,{span:3,children:s.jsx(m,{placeholder:"攻击",value:e.atk,onChange:e=>S(a,r,"atk",e),className:"w-full bg-slate-600/50 border-slate-500 text-white hover:bg-white hover:text-gray-900 focus:bg-white focus:text-gray-900"})}),s.jsx(h,{span:3,children:s.jsx(l,{type:"text",danger:!0,icon:s.jsx(v,{}),onClick:()=>((e,s)=>{if(!N)return;const a=(N[e]||[]).filter((e,a)=>a!==s);y({...N,[e]:a})})(a,r),className:"text-red-400 hover:text-red-300"})})]})},r);return s.jsx(n,{title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xl font-bold text-white",children:"编辑背包"}),s.jsxs("span",{className:"text-slate-300",children:["用户ID: ",null==o?void 0:o.userId]})]}),open:e,onCancel:a,width:1200,footer:[s.jsx(l,{onClick:a,className:"bg-slate-600 border-slate-500 text-white",children:"取消"},"cancel"),s.jsx(l,{type:"primary",icon:s.jsx(p,{}),onClick:async()=>{try{const e=await f.validateFields();if(N){const s={...N,userId:e.userId,"灵石":e.灵石,"灵石上限":e.灵石上限,"等级":e.等级};r(s)}}catch(e){}},loading:u,className:"bg-gradient-to-r from-purple-500 to-pink-500 border-0",children:"保存"},"save")],className:"najie-edit-modal xiuxian-modal",children:s.jsxs("div",{className:"space-y-6",children:[s.jsx(c,{className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-slate-700/50",children:s.jsx(d,{form:f,layout:"vertical",children:s.jsxs(x,{gutter:16,children:[s.jsx(h,{span:8,children:s.jsx(d.Item,{label:s.jsx("span",{className:"text-slate-200",children:"用户ID"}),name:"userId",rules:[{required:!0,message:"请输入用户ID"}],children:s.jsx(t,{className:"bg-slate-700/50 border-slate-600 text-white placeholder-slate-400 hover:bg-white hover:text-gray-900 hover:placeholder-gray-500 focus:bg-white focus:text-gray-900 focus:placeholder-gray-500"})})}),s.jsx(h,{span:8,children:s.jsx(d.Item,{label:s.jsx("span",{className:"text-slate-200",children:"灵石"}),name:"灵石",rules:[{required:!0,message:"请输入灵石数量"}],children:s.jsx(m,{className:"w-full bg-slate-700/50 border-slate-600 text-white hover:bg-white hover:text-gray-900 focus:bg-white focus:text-gray-900",min:0,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>(null==e?void 0:e.replace(/\$\s?|(,*)/g,""))||""})})}),s.jsx(h,{span:8,children:s.jsx(d.Item,{label:s.jsx("span",{className:"text-slate-200",children:"灵石上限"}),name:"灵石上限",children:s.jsx(m,{className:"w-full bg-slate-700/50 border-slate-600 text-white hover:bg-white hover:text-gray-900 focus:bg-white focus:text-gray-900",min:0,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>(null==e?void 0:e.replace(/\$\s?|(,*)/g,""))||""})})})]})})}),s.jsx(g,{type:"card",className:"najie-tabs xiuxian-tabs",tabBarStyle:{backgroundColor:"rgba(30, 41, 59, 0.8)",borderBottom:"1px solid rgba(71, 85, 105, 0.5)"},tabBarGutter:8,items:B.map(e=>{var a;return{key:e.key,label:s.jsxs("span",{className:"text-white hover:text-purple-300 transition-colors",children:[e.label," (",(null==(a=null==N?void 0:N[e.key])?void 0:a.length)||0,")"]}),children:s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-bold text-white",children:e.label}),s.jsxs("div",{className:"flex gap-6",children:[s.jsx(t,{value:w,onChange:e=>k(e.target.value),className:"max-w-40 xiuxian-input"}),s.jsx(l,{type:"primary",icon:s.jsx(j,{}),onClick:()=>(e=>{if(!w)return;if(!N)return;if(N[e].some(e=>e.name===w))return void b.error("已存在该物品");const s={name:w,grade:"",pinji:1,"数量":1};y({...N,[e]:[...N[e]||[],s]})})(e.key),className:"bg-gradient-to-r from-green-500 to-emerald-500 border-0",children:"添加物品"})]})]}),s.jsx("div",{className:"space-y-2",children:((null==N?void 0:N[e.key])||[]).map((s,a)=>C(s,e.key,a))}),(()=>{const s=null==N?void 0:N[e.key];return!s||!Array.isArray(s)||0===s.length})()&&s.jsxs("div",{className:"text-center py-8 text-slate-400",children:["暂无",e.label,"，点击上方按钮添加"]})]})}})})]})})}const P=()=>{const{user:s}=a(),[t,l]=i.useState([]),[r,n]=i.useState(!1),[o,d]=i.useState(""),[c,x]=i.useState(null),[h,m]=i.useState(!1),[u,g]=i.useState(!1),[j,p]=i.useState(!1),[v,N]=i.useState({current:1,pageSize:f,total:0,totalPages:0}),y=async(a=1,t=f)=>{if(s){n(!0);try{const s=localStorage.getItem("token");if(!s)return void b.error("未找到登录令牌");const r=await(async(s,a={})=>{try{const s=await e({url:"/najie",method:"GET",params:a});return 200===s.code?{success:!0,data:s.data}:{success:!1,message:s.message}}catch(t){return{success:!1,message:"网络错误"}}})(0,{page:a,pageSize:t,search:o});r.success&&r.data?(l(r.data.list),N(r.data.pagination)):b.error(r.message||"获取背包数据失败")}catch(r){b.error("获取背包数据失败")}finally{n(!1)}}};i.useEffect(()=>{y(1,f)},[s]);return{najieList:t,loading:r,searchText:o,selectedNajie:c,najieDetailVisible:h,najieEditVisible:u,editLoading:j,pagination:v,fetchNajie:y,handleSearchAndFilter:()=>{y(1,v.pageSize)},handleTableChange:(e,s)=>{y(e,s)},handleEditNajie:e=>{x(e),g(!0)},handleSaveNajie:async s=>{p(!0);try{const a=localStorage.getItem("token");if(!a)return void b.error("未找到登录令牌");const t=await(async(s,a)=>{try{const s=await e({url:"/najie",method:"PUT",data:a});return 200===s.code?{success:!0,message:s.message||"纳戒信息更新成功"}:{success:!1,message:s.message||"纳戒信息更新失败"}}catch(t){return{success:!1,message:"更新纳戒信息失败"}}})(0,s);t.success?(b.success("背包更新成功"),g(!1),y(v.current,v.pageSize)):b.error(t.message||"背包更新失败")}catch(a){b.error("背包更新失败")}finally{p(!1)}},getTotalItems:e=>["装备","丹药","道具","功法","草药","材料","仙宠","仙宠口粮"].reduce((s,a)=>s+(Array.isArray(e[a])?e[a].length:0),0),setSearchText:d,setSelectedNajie:x,setNajieDetailVisible:m,setNajieEditVisible:g}};function $(){const{najieList:e,loading:a,searchText:t,selectedNajie:l,najieDetailVisible:r,najieEditVisible:i,editLoading:n,pagination:o,fetchNajie:d,handleSearchAndFilter:c,handleTableChange:x,handleEditNajie:h,handleSaveNajie:m,getTotalItems:g,setSearchText:j,setSelectedNajie:p,setNajieDetailVisible:b,setNajieEditVisible:v}=P(),f=[{title:s.jsx("div",{className:"flex items-center gap-2 text-purple-400 font-bold",children:s.jsx("span",{children:"用户信息"})}),key:"userInfo",width:150,render:(e,a)=>s.jsxs("div",{children:[s.jsxs("div",{className:"font-bold text-white",children:["用户ID: ",a.userId]}),s.jsxs("div",{className:"text-xs text-slate-400",children:["背包等级: ",a.等级||1]})]})},{title:s.jsx("div",{className:"flex items-center gap-2 text-green-400 font-bold",children:s.jsx("span",{children:"灵石信息"})}),key:"lingshi",width:120,render:(e,a)=>{var t,l;return s.jsxs("div",{children:[s.jsxs("div",{className:"text-xs text-green-500",children:["当前: ",(null==(t=a.灵石)?void 0:t.toLocaleString())||0]}),s.jsxs("div",{className:"text-xs text-yellow-500",children:["上限: ",(null==(l=a.灵石上限)?void 0:l.toLocaleString())||0]})]})}},{title:s.jsx("div",{className:"flex items-center gap-2 text-blue-400 font-bold",children:s.jsx("span",{children:"物品统计"})}),key:"items",width:200,render:(e,a)=>{var t,l,r;return s.jsxs("div",{children:[s.jsxs("div",{className:"text-xs text-slate-300",children:["总物品: ",g(a)]}),s.jsxs("div",{className:"text-xs text-slate-300",children:["装备: ",(null==(t=a.装备)?void 0:t.length)||0]}),s.jsxs("div",{className:"text-xs text-slate-300",children:["丹药: ",(null==(l=a.丹药)?void 0:l.length)||0]}),s.jsxs("div",{className:"text-xs text-slate-300",children:["道具: ",(null==(r=a.道具)?void 0:r.length)||0]})]})}},{title:s.jsx("div",{className:"flex items-center gap-2 text-yellow-400 font-bold",children:s.jsx("span",{children:"操作"})}),key:"actions",width:120,render:(e,a)=>s.jsxs("div",{className:"flex gap-2",children:[s.jsx(C,{title:"查看详情",children:s.jsx("button",{className:"p-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg hover:from-blue-600 hover:to-cyan-600 transition-all duration-200 shadow-lg hover:shadow-xl",onClick:()=>{p(a),b(!0)},children:s.jsx(D,{className:"text-lg"})})}),s.jsx(C,{title:"编辑背包",children:s.jsx("button",{className:"p-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-200 shadow-lg hover:shadow-xl",onClick:()=>h(a),children:s.jsx(u,{className:"text-lg"})})})]})}];return s.jsxs(N,{children:[s.jsx(y,{icon:s.jsx(O,{}),title:"背包管理",subtitle:"管理修仙界道友的背包物品",actions:s.jsx(I,{loading:a,onClick:()=>d(1,o.pageSize)})}),s.jsx(w,{placeholder:"搜索用户ID",value:t,onChange:j,onSearch:c,onKeyPress:e=>"Enter"===e.key&&c(),className:"mb-6"}),s.jsx(S,{title:"背包列表",icon:s.jsx(O,{}),children:s.jsx(T,{columns:f,dataSource:e,rowKey:"userId",loading:a,rowClassName:e=>"corrupted"===e.数据状态?"bg-gradient-to-r from-yellow-500/10 to-orange-500/10 border-l-4 border-yellow-400  bg-slate-700 hover:bg-slate-600":"hover:bg-gradient-to-r hover:from-purple-500/10 hover:to-blue-500/10 transition-all duration-300 bg-slate-700 hover:bg-slate-600",pagination:{current:o.current,pageSize:o.pageSize,total:o.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>`第 ${s[0]}-${s[1]} 条，共 ${e} 条`},onPaginationChange:x,scroll:{x:1200}})}),s.jsx(X,{najieDetailVisible:r,setNajieDetailVisible:b,selectedNajie:l,getTotalItems:g}),s.jsx(R,{visible:i,onCancel:()=>v(!1),onSave:m,najie:l,loading:n})]})}export{$ as default};
