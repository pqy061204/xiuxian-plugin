import{a as e,j as s}from"./index-B2kNOiSW.js";import{r as t}from"./react-vendor-DC8kK7ng.js";import{d as a}from"./dayjs.min-Xkjmg--Y.js";import{c as n}from"./index-DXDPliM2.js";import{j as r,a0 as l,B as c,a1 as i,d as o,o as m,I as d,S as x}from"./XiuxianUserSelector-BF0ikhJO.js";import{X as u}from"./XiuxianStatCard-CIij2zo2.js";import{X as p,a as h}from"./XiuxianPageTitle-DZEpOGbC.js";import{X as j}from"./XiuxianSearchBar-D3Kv-zDm.js";import{I as g,X as f}from"./XiuxianTableContainer-DhC13tFt.js";import{X as v}from"./XiuxianRefreshButton-xkCbosgb.js";import{X as y}from"./XiuxianEmptyState-BYdWKdlW.js";import{X as b}from"./XiuxianTabGroup-CRU7RY8N.js";import{X as N}from"./XiuxianTableWithPagination-DKSLFAl9.js";import{F as C}from"./index-CNY5tfv2.js";import{R as w}from"./PlusOutlined-CfI3nvkf.js";import{R as O}from"./DeleteOutlined-Bym2ICp0.js";import{R as S}from"./ClockCircleOutlined-ODeB101c.js";import{A as T,M as I}from"./index-Du8BvPLj.js";import{R as k,s as E}from"./index-BYawNXHP.js";import{R as P}from"./UserOutlined-COpaLYKt.js";import{S as z}from"./Table-DDK18TB_.js";import{g as $,C as X,a as H}from"./reactNode-DFpyyHOf.js";import{g as D,a as M,P as R}from"./index-NDzFVU3Y.js";import{T as Y}from"./index-B1hnwFag.js";import{R as B}from"./CheckCircleOutlined-CphydNo_.js";import"./SearchOutlined-DbEbI350.js";import"./extendsObject-CAj5MA3o.js";import"./ExclamationCircleOutlined-CfPnhGyp.js";import"./row-Bx9DYSg2.js";import"./index-DVZYsZ2A.js";import"./PlusOutlined-ByZyTB3m.js";import"./context-DpP0BR6V.js";import"./index-CV6p3N25.js";var V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"};function L(){return L=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},L.apply(this,arguments)}const W=(e,s)=>t.createElement(g,L({},e,{ref:s,icon:V})),F=t.forwardRef(W);var A={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"};function U(){return U=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},U.apply(this,arguments)}const q=(e,s)=>t.createElement(g,U({},e,{ref:s,icon:A})),G=t.forwardRef(q);var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v68c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-68c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zm-40 376H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"unlock",theme:"outlined"};function J(){return J=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},J.apply(this,arguments)}const Q=(e,s)=>t.createElement(g,J({},e,{ref:s,icon:K})),_=t.forwardRef(Q),Z=$("Popconfirm",e=>(e=>{const{componentCls:s,iconCls:t,antCls:a,zIndexPopup:n,colorText:r,colorWarning:l,marginXXS:c,marginXS:i,fontSize:o,fontWeightStrong:m,colorTextHeading:d}=e;return{[s]:{zIndex:n,[`&${a}-popover`]:{fontSize:o},[`${s}-message`]:{marginBottom:i,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${s}-message-icon ${t}`]:{color:l,fontSize:o,lineHeight:1,marginInlineEnd:i},[`${s}-title`]:{fontWeight:m,color:d,"&:only-child":{fontWeight:"normal"}},[`${s}-description`]:{marginTop:c,color:r}},[`${s}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:i}}}}})(e),e=>{const{zIndexPopupBase:s}=e;return{zIndexPopup:s+60}},{resetStyle:!1});const ee=e=>{const{prefixCls:s,okButtonProps:a,cancelButtonProps:n,title:o,description:m,cancelText:d,okText:x,okType:u="primary",icon:p=t.createElement(k,null),showCancel:h=!0,close:j,onConfirm:g,onCancel:f,onPopupClick:v}=e,{getPrefixCls:y}=t.useContext(X),[b]=r("Popconfirm",l.Popconfirm),N=D(o),C=D(m);return t.createElement("div",{className:`${s}-inner-content`,onClick:v},t.createElement("div",{className:`${s}-message`},p&&t.createElement("span",{className:`${s}-message-icon`},p),t.createElement("div",{className:`${s}-message-text`},N&&t.createElement("div",{className:`${s}-title`},N),C&&t.createElement("div",{className:`${s}-description`},C))),t.createElement("div",{className:`${s}-buttons`},h&&t.createElement(c,Object.assign({onClick:f,size:"small"},n),d||(null==b?void 0:b.cancelText)),t.createElement(T,{buttonProps:Object.assign(Object.assign({size:"small"},i(u)),a),actionFn:g,close:j,prefixCls:y("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},x||(null==b?void 0:b.okText))))};const se=t.forwardRef((e,s)=>{var a,r;const{prefixCls:l,placement:c="top",trigger:i="click",okType:d="primary",icon:x=t.createElement(k,null),children:u,overlayClassName:p,onOpenChange:h,onVisibleChange:j,overlayStyle:g,styles:f,classNames:v}=e,y=function(e,s){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(t[a[n]]=e[a[n]])}return t}(e,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange","overlayStyle","styles","classNames"]),{getPrefixCls:b,className:N,style:C,classNames:w,styles:O}=H("popconfirm"),[S,T]=o(!1,{value:null!==(a=e.open)&&void 0!==a?a:e.visible,defaultValue:null!==(r=e.defaultOpen)&&void 0!==r?r:e.defaultVisible}),I=(e,s)=>{T(e,!0),null==j||j(e),null==h||h(e,s)},E=b("popconfirm",l),P=n(E,N,p,w.root,null==v?void 0:v.root),z=n(w.body,null==v?void 0:v.body),[$]=Z(E);return $(t.createElement(R,Object.assign({},m(y,["title"]),{trigger:i,placement:c,onOpenChange:(s,t)=>{const{disabled:a=!1}=e;a||I(s,t)},open:S,ref:s,classNames:{root:P,body:z},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},O.root),C),g),null==f?void 0:f.root),body:Object.assign(Object.assign({},O.body),null==f?void 0:f.body)},content:t.createElement(ee,Object.assign({okType:d,icon:x},e,{prefixCls:E,close:e=>{I(!1,e)},onConfirm:s=>{var t;return null===(t=e.onConfirm)||void 0===t?void 0:t.call(void 0,s)},onCancel:s=>{var t;I(!1,s),null===(t=e.onCancel)||void 0===t||t.call(void 0,s)}})),"data-popover-inject":!0}),u))});se._InternalPanelDoNotUseOrYouWillBeFired=e=>{const{prefixCls:s,placement:a,className:r,style:l}=e,c=function(e,s){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(t[a[n]]=e[a[n]])}return t}(e,["prefixCls","placement","className","style"]),{getPrefixCls:i}=t.useContext(X),o=i("popconfirm",s),[m]=Z(o);return m(t.createElement(M,{placement:a,className:n(o,r),style:l,content:t.createElement(ee,Object.assign({prefixCls:o},c))}))};const{Option:te}=x,ae=({visible:n,onCancel:r})=>{const[l,i]=t.useState("mute"),[o,m]=t.useState([]),[d,x]=t.useState(!1),u=async s=>{x(!0);try{const t=await(async(s="mute",t=100)=>{try{const a=await e({url:`/mute-logs?type=${s}&limit=${t}`,method:"GET"});return 200===a.code?{success:!0,data:a.data}:{success:!1,message:a.message}}catch(a){return{success:!1,message:"网络错误"}}})(s,100);t.success&&t.data?m(t.data.list):E.error(t.message||"获取日志失败")}catch(t){E.error("获取日志失败")}finally{x(!1)}},p=async s=>{try{const t=await(async(s="all")=>{try{const t=await e({url:`/mute-logs?type=${s}`,method:"DELETE"});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(s);t.success?(E.success(t.message||"清理日志成功"),u(l)):E.error(t.message||"清理日志失败")}catch(t){E.error("清理日志失败")}};t.useEffect(()=>{n&&u(l)},[n,l]);const h=[{name:"mute",icon:s.jsx(G,{}),content:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:"禁言记录"}),s.jsx(se,{title:"确定要清理禁言记录吗？",onConfirm:()=>p("mute"),okText:"确定",cancelText:"取消",children:s.jsx(c,{danger:!0,size:"small",children:"清理禁言记录"})})]}),s.jsx("div",{className:"max-h-96 overflow-y-auto",children:d?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-slate-400",children:"加载中..."})}):0===o.length?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-slate-400",children:"暂无禁言记录"})}):s.jsx("div",{className:"space-y-2",children:o.map((e,t)=>s.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"font-mono text-sm text-white",children:e.userId}),e.reason&&s.jsx(Y,{color:"orange",className:"text-xs",children:e.reason}),e.duration&&s.jsxs(Y,{color:"blue",className:"text-xs",children:[Math.floor(e.duration/60),"分钟"]})]}),s.jsx("div",{className:"text-slate-400 text-xs",children:a(e.timestamp).format("YYYY-MM-DD HH:mm:ss")})]}),e.adminId&&s.jsxs("div",{className:"text-slate-500 text-xs mt-1",children:["操作管理员: ",e.adminId]})]},t))})})]})},{name:"unmute",icon:s.jsx(B,{}),content:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:"解除记录"}),s.jsx(se,{title:"确定要清理解除记录吗？",onConfirm:()=>p("unmute"),okText:"确定",cancelText:"取消",children:s.jsx(c,{danger:!0,size:"small",children:"清理解除记录"})})]}),s.jsx("div",{className:"max-h-96 overflow-y-auto",children:d?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-slate-400",children:"加载中..."})}):0===o.length?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-slate-400",children:"暂无解除记录"})}):s.jsx("div",{className:"space-y-2",children:o.map((e,t)=>s.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"font-mono text-sm text-white",children:e.userId}),e.reason&&s.jsx(Y,{color:"green",className:"text-xs",children:e.reason})]}),s.jsx("div",{className:"text-slate-400 text-xs",children:a(e.timestamp).format("YYYY-MM-DD HH:mm:ss")})]}),e.adminId&&s.jsxs("div",{className:"text-slate-500 text-xs mt-1",children:["操作管理员: ",e.adminId]})]},t))})})]})}];return s.jsx(I,{title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(F,{className:"text-blue-400"}),s.jsx("span",{className:"text-white",children:"禁言日志"})]}),open:n,onCancel:r,footer:s.jsxs("div",{className:"flex justify-between",children:[s.jsx(se,{title:"确定要清理所有日志吗？",onConfirm:()=>p("all"),okText:"确定",cancelText:"取消",children:s.jsx(c,{danger:!0,children:"清理所有日志"})}),s.jsx(c,{onClick:r,children:"关闭"})]}),className:"xiuxian-modal",width:900,children:s.jsx(b,{tabs:h,activeTab:l,onTabChange:e=>{i(e),u(e)},className:"mt-4"})})},ne=()=>{const[n,r]=t.useState([]),[l,i]=t.useState(!1),[o,m]=t.useState(""),[g,b]=t.useState(1),[T,k]=t.useState(10),[$,X]=t.useState(0),[H,D]=t.useState([]),[M,R]=t.useState(!1),[Y,B]=t.useState(!1),[V]=C.useForm(),L=async()=>{i(!0);try{const s=await(async()=>{try{const s=await e({url:"/mute-list",method:"GET"});return 200===s.code?{success:!0,data:s.data}:{success:!1,message:s.message}}catch(s){return{success:!1,message:"网络错误"}}})();s.success&&s.data?(r(s.data.list),X(s.data.total)):E.error(s.message||"获取禁言列表失败")}catch(s){E.error("获取禁言列表失败")}finally{i(!1)}},W=async s=>{try{const t=await(async s=>{try{const t=await e({url:`/mute-list?userId=${s}`,method:"DELETE"});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(s);t.success?(E.success("禁言解除成功"),L()):E.error(t.message||"禁言解除失败")}catch(t){E.error("禁言解除失败")}},A=n.filter(e=>e.userId.toLowerCase().includes(o.toLowerCase())),U=A.slice((g-1)*T,g*T),q=[{title:s.jsxs("div",{className:"flex items-center gap-2 text-purple-400 font-bold",children:[s.jsx(P,{className:"text-lg"}),s.jsx("span",{children:"用户ID"})]}),dataIndex:"userId",key:"userId",render:e=>s.jsx("span",{className:"font-mono text-sm text-white bg-slate-700/50 px-2 py-1 rounded",children:e})},{title:s.jsxs("div",{className:"flex items-center gap-2 text-orange-400 font-bold",children:[s.jsx(S,{className:"text-lg"}),s.jsx("span",{children:"剩余时间"})]}),dataIndex:"remainingTime",key:"remainingTime",render:(e,t)=>s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-orange-400 font-medium",children:e})})},{title:s.jsx("div",{className:"flex items-center gap-2 text-blue-400 font-bold",children:s.jsx("span",{children:"解除时间"})}),dataIndex:"unlockTime",key:"unlockTime",render:e=>s.jsx("span",{className:"text-slate-300",children:a(e).format("YYYY-MM-DD HH:mm:ss")})},{title:s.jsx("div",{className:"flex items-center gap-2 text-green-400 font-bold",children:s.jsx("span",{children:"操作"})}),key:"action",render:(e,t)=>s.jsx(z,{children:s.jsx(se,{title:"确定要解除该用户的禁言吗？",onConfirm:()=>W(t.userId),okText:"确定",cancelText:"取消",children:s.jsx(c,{type:"text",size:"small",icon:s.jsx(_,{}),className:"text-green-400 hover:text-green-300 hover:bg-green-400/10",children:"解除禁言"})})})}],K={selectedRowKeys:H,onChange:e=>{D(e)}};return t.useEffect(()=>{L()},[]),s.jsxs(p,{children:[s.jsx(h,{icon:"🔇",title:"禁言管理",subtitle:"管理系统中的用户禁言状态",actions:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(c,{type:"primary",icon:s.jsx(w,{}),onClick:()=>R(!0),className:"bg-gradient-to-r from-red-500 to-pink-500 border-0 hover:from-red-600 hover:to-pink-600",children:"添加禁言"}),s.jsxs(c,{danger:!0,icon:s.jsx(O,{}),disabled:0===H.length,onClick:async()=>{if(0!==H.length)try{const s=await(async s=>{try{const t=await e({url:"/mute-list",method:"PUT",data:{userIds:s}});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(H);s.success&&s.data?(E.success(`批量解除禁言完成，成功解除 ${s.data.successCount} 个用户`),D([]),L()):E.error(s.message||"批量解除禁言失败")}catch(s){E.error("批量解除禁言失败")}else E.warning("请选择要解除禁言的用户")},children:["批量解除 (",H.length,")"]}),s.jsx(c,{icon:s.jsx(F,{}),onClick:()=>B(!0),className:"bg-gradient-to-r from-blue-500 to-cyan-500 border-0 hover:from-blue-600 hover:to-cyan-600",children:"查看日志"}),s.jsx(v,{loading:l,onClick:L})]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsx(u,{title:"当前禁言用户",value:$,icon:s.jsx(G,{}),gradient:"red"}),s.jsx(u,{title:"即将解除",value:n.filter(e=>e.ttl<=3600).length,icon:s.jsx(S,{}),gradient:"orange"}),s.jsx(u,{title:"已选择",value:H.length,icon:s.jsx(_,{}),gradient:"green"})]}),s.jsx(j,{placeholder:"搜索用户ID...",value:o,onChange:m,onSearch:()=>{}}),s.jsx(f,{title:"禁言列表",children:0===A.length?s.jsx(y,{icon:"🔇",title:"暂无禁言记录",description:"当前没有用户被禁言"}):s.jsx(N,{columns:q,dataSource:U,rowKey:"userId",loading:l,rowSelection:K,pagination:{current:g,pageSize:T,total:A.length,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>`第 ${s[0]}-${s[1]} 条，共 ${e} 条`},onPaginationChange:(e,s)=>{b(e),k(s||10)}})})]}),s.jsx(I,{title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(G,{className:"text-red-400"}),s.jsx("span",{className:"text-white",children:"添加禁言"})]}),open:M,onCancel:()=>R(!1),onOk:()=>V.submit(),okText:"确定",cancelText:"取消",className:"xiuxian-modal",width:500,children:s.jsxs(C,{form:V,layout:"vertical",onFinish:async s=>{try{const t=await(async s=>{try{const t=await e({url:"/mute-list",method:"POST",data:s});return 200===t.code?{success:!0,data:t.data}:{success:!1,message:t.message}}catch(t){return{success:!1,message:"网络错误"}}})(s);t.success?(E.success("禁言设置成功"),R(!1),V.resetFields(),L()):E.error(t.message||"禁言设置失败")}catch(t){E.error("禁言设置失败")}},className:"mt-4",children:[s.jsx(C.Item,{name:"userId",label:s.jsx("span",{className:"text-slate-300",children:"用户ID"}),rules:[{required:!0,message:"请输入用户ID"}],children:s.jsx(d,{placeholder:"请输入用户ID",className:"xiuxian-input"})}),s.jsx(C.Item,{name:"duration",label:s.jsx("span",{className:"text-slate-300",children:"禁言时长"}),rules:[{required:!0,message:"请输入禁言时长"}],children:s.jsx(d,{placeholder:"例如: 30m, 2h, 3600s",className:"xiuxian-input",addonAfter:s.jsxs(x,{defaultValue:"m",className:"w-20",children:[s.jsx(te,{value:"m",children:"分钟"}),s.jsx(te,{value:"h",children:"小时"}),s.jsx(te,{value:"s",children:"秒"})]})})}),s.jsx(C.Item,{name:"reason",label:s.jsx("span",{className:"text-slate-300",children:"禁言原因"}),children:s.jsx(d.TextArea,{placeholder:"请输入禁言原因（可选）",rows:3,className:"xiuxian-input"})})]})}),s.jsx(ae,{visible:Y,onCancel:()=>B(!1)})]})};export{ne as default};
